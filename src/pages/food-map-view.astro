---
import DefaultLayout from '@layouts/DefaultLayout.astro';
import { Leaflet, Marker, Popup } from "astro-leaflet";
import { supabase } from 'src/lib/supabase';

const { data, error } = await supabase
  .from('sites')
  .select()
  .eq('category', 'food')

if (error) {
  console.error(error);
  throw error;
}
---

<DefaultLayout title="Food Map View">
    <div class="container mb-32">
        <h1 class="mb-10">Food Map View</h1>
        <p class="text-2xl mb-15">Use the interactive map below to find food near you.</p>
<Leaflet
  id="map-quick-start"
  style=""
  options={{ center: [39.9925, -75.2411], zoom: 11 }}
>
    {
      data.map((item) => (
        <Marker latlng={[item.site_lat, item.site_long]} options={{alt: item.site_name}}>
          <Popup content=`<h4 class="text-lg/5">${item.site_name}</h4><p class="mt-3!">${item.site_description}<br>${item.site_date_time}<br>${item.site_address}</p>` />
        </Marker>
      ))
    }
</Leaflet>
    </div>
</DefaultLayout>